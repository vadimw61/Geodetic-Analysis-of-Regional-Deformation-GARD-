<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>GARD â€” ĞÑ‚Ñ‡Ñ‘Ñ‚ Ğ¿Ğ¾ ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ğ¸</title>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <style>
        /* â”€â”€ Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        *, *::before, *::after { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f0f2f5;
            color: #1a1a2e;
        }

        /* â”€â”€ Ğ¨Ğ°Ğ¿ĞºĞ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 60%, #0f3460 100%);
            color: white;
            padding: 24px 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 12px rgba(0,0,0,0.3);
        }
        .header-left h1 {
            margin: 0 0 4px 0;
            font-size: 26px;
            letter-spacing: 1px;
        }
        .header-left .subtitle {
            font-size: 13px;
            opacity: 0.7;
            letter-spacing: 0.5px;
        }
        .header-right {
            display: flex;
            gap: 10px;
        }
        .btn {
            padding: 9px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
        }
        .btn-print {
            background: #e2e8f0;
            color: #1a1a2e;
        }
        .btn-print:hover { background: #cbd5e1; }
        .btn-back {
            background: rgba(255,255,255,0.15);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }
        .btn-back:hover { background: rgba(255,255,255,0.25); }

        /* â”€â”€ ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .container {
            max-width: 1300px;
            margin: 30px auto;
            padding: 0 24px;
        }

        /* â”€â”€ ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .card {
            background: white;
            border-radius: 10px;
            padding: 22px 26px;
            margin-bottom: 22px;
            box-shadow: 0 1px 6px rgba(0,0,0,0.08);
        }
        .card-title {
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #64748b;
            margin: 0 0 16px 0;
            padding-bottom: 10px;
            border-bottom: 1px solid #f1f5f9;
        }

        /* â”€â”€ Ğ¡ĞµÑ‚ĞºĞ° Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(175px, 1fr));
            gap: 14px;
        }
        .metric {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 14px 16px;
        }
        .metric-label {
            font-size: 11px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        .metric-value {
            font-size: 20px;
            font-weight: 700;
            color: #1e293b;
            line-height: 1.1;
        }
        .metric-unit {
            font-size: 11px;
            color: #94a3b8;
            margin-top: 2px;
        }
        .metric.highlight {
            background: #eff6ff;
            border-color: #bfdbfe;
        }
        .metric.highlight .metric-value { color: #1d4ed8; }
        .metric.warn {
            background: #fff7ed;
            border-color: #fed7aa;
        }
        .metric.warn .metric-value { color: #c2410c; }
        .metric.good {
            background: #f0fdf4;
            border-color: #bbf7d0;
        }
        .metric.good .metric-value { color: #15803d; }

        /* â”€â”€ Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ‚ Ğ¸ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ĞµĞ¹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13.5px;
        }
        .data-table th {
            background: #f8fafc;
            color: #64748b;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 9px 14px;
            text-align: left;
            border-bottom: 2px solid #e2e8f0;
        }
        .data-table td {
            padding: 10px 14px;
            border-bottom: 1px solid #f1f5f9;
            font-family: 'Consolas', 'Courier New', monospace;
        }
        .data-table tr:last-child td { border-bottom: none; }
        .data-table tr:hover td { background: #f8fafc; }
        .td-label {
            font-family: 'Segoe UI', Arial, sans-serif;
            font-weight: 600;
            color: #374151;
        }
        .td-sigma { color: #94a3b8; font-size: 12px; }

        /* â”€â”€ Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑĞ½Ñ‹Ğµ Ğ±ĞµĞ¹Ğ´Ğ¶Ğ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.3px;
        }
        .badge-ok  { background: #dcfce7; color: #166534; }
        .badge-warn { background: #fef3c7; color: #92400e; }
        .badge-err  { background: #fee2e2; color: #991b1b; }

        /* â”€â”€ Ğ“Ñ€Ğ°Ñ„Ğ¸ĞºĞ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .graphs-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
        }
        .plot-wrap { height: 260px; }

        /* â”€â”€ Ğ¤ÑƒÑ‚ĞµÑ€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .footer {
            text-align: center;
            padding: 20px;
            color: #94a3b8;
            font-size: 12px;
        }

        /* â”€â”€ ĞŸĞµÑ‡Ğ°Ñ‚ÑŒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media print {
            body { background: white; }
            .header { background: #1a1a2e !important; -webkit-print-color-adjust: exact; }
            .btn-print, .btn-back { display: none; }
            .card { box-shadow: none; border: 1px solid #e2e8f0; }
            .container { max-width: 100%; padding: 0 10px; }
            .plot-wrap { height: 220px; }
            .graphs-grid { page-break-inside: avoid; }
        }

        /* â”€â”€ Ğ›Ğ¾Ğ°Ğ´ĞµÑ€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #loader {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 60vh;
            font-size: 18px;
            color: #94a3b8;
        }
    </style>
</head>
<body>

<!-- Ğ¨Ğ°Ğ¿ĞºĞ° -->
<div class="header">
    <div class="header-left">
        <h1>ğŸ›°ï¸ GARD Analytics â€” <span id="hdr-sid">â€”</span></h1>
        <div class="subtitle" id="hdr-sub">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…â€¦</div>
    </div>
    <div class="header-right">
        <button class="btn btn-back" onclick="window.close()">â† Ğ’ĞµÑ€Ğ½ÑƒÑ‚ÑŒÑÑ Ğ½Ğ° ĞºĞ°Ñ€Ñ‚Ñƒ</button>
        <button class="btn btn-print" onclick="window.print()">ğŸ–¨ ĞŸĞµÑ‡Ğ°Ñ‚ÑŒ / PDF</button>
    </div>
</div>

<div class="container">
    <div id="loader">â³ Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ğ¸â€¦</div>
    <div id="content" style="display:none;">

        <!-- â”€â”€ Ğ‘Ğ»Ğ¾Ğº ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="card">
            <div class="card-title">ĞĞ±Ñ‰Ğ¸Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ</div>
            <div class="metrics-grid" id="status-metrics"></div>
        </div>

        <!-- â”€â”€ ĞšĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ‚Ñ‹ Ğ½Ğ° ÑĞ¿Ğ¾Ñ…Ñƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="card">
            <div class="card-title">ĞšĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ‚Ñ‹ Ğ½Ğ° Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ğ½ÑƒÑ ÑĞ¿Ğ¾Ñ…Ñƒ</div>
            <table class="data-table" id="coords-table"></table>
        </div>

        <!-- â”€â”€ Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚Ğ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="card">
            <div class="card-title">Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚Ğ¸ ÑĞ¼ĞµÑ‰ĞµĞ½Ğ¸Ñ</div>
            <table class="data-table" id="vel-table"></table>
        </div>

        <!-- â”€â”€ ĞšĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="card">
            <div class="card-title">ĞšĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¸ Ğ¾Ñ…Ğ²Ğ°Ñ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…</div>
            <div class="metrics-grid" id="quality-metrics"></div>
        </div>

        <!-- â”€â”€ Ğ“Ñ€Ğ°Ñ„Ğ¸ĞºĞ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="card">
            <div class="card-title">Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ€ÑĞ´Ñ‹ â€” ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ° X (ECEF)</div>
            <div class="plot-wrap" id="plot-x"></div>
        </div>
        <div class="card">
            <div class="card-title">Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ€ÑĞ´Ñ‹ â€” ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ° Y (ECEF)</div>
            <div class="plot-wrap" id="plot-y"></div>
        </div>
        <div class="card">
            <div class="card-title">Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ€ÑĞ´Ñ‹ â€” ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ° Z (ECEF)</div>
            <div class="plot-wrap" id="plot-z"></div>
        </div>

    </div><!-- /#content -->
</div>

<div class="footer">
    GARD Analytics Pro &nbsp;Â·&nbsp; Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ NGL/IGS20 &nbsp;Â·&nbsp;
    ÑÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ <span id="gen-time"></span>
</div>

<script>
// â”€â”€ Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ· sessionStorage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('gen-time').textContent = new Date().toLocaleString('ru-RU');

const raw = sessionStorage.getItem('jgrf_station_detail');
if (!raw) {
    document.getElementById('loader').innerHTML =
        'âŒ Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹. ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ Ñ‡ĞµÑ€ĞµĞ· ĞºĞ°Ñ€Ñ‚Ñƒ.';
} else {
    const payload = JSON.parse(raw);
    const s    = payload.station;
    const meta = payload.meta;
    renderAll(s, meta);
}

function renderAll(s, meta) {
    document.getElementById('loader').style.display = 'none';
    document.getElementById('content').style.display = 'block';

    document.getElementById('hdr-sid').textContent = s.id;
    document.getElementById('hdr-sub').textContent =
        `Ğ­Ğ¿Ğ¾Ñ…Ğ° ${meta.epoch} Â· ${meta.zone_name} Â· ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ¾ ${meta.processed} ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ğ¹ Ğ² Ñ€ĞµĞ³Ğ¸Ğ¾Ğ½Ğµ`;

    renderStatusMetrics(s, meta);
    renderCoordsTable(s, meta);
    renderVelTable(s, meta);
    renderQualityMetrics(s);
    renderPlot('plot-x', s.graph.t, s.graph.raw_x, s.graph.filt_x, s.graph.trend_x, 'Î”X (Ğ¼)', '#3b82f6');
    renderPlot('plot-y', s.graph.t, s.graph.raw_y, s.graph.filt_y, s.graph.trend_y, 'Î”Y (Ğ¼)', '#10b981');
    renderPlot('plot-z', s.graph.t, s.graph.raw_z, s.graph.filt_z, s.graph.trend_z, 'Î”Z (Ğ¼)', '#f59e0b');
}

// â”€â”€ Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderStatusMetrics(s, meta) {
    const epochOk  = s.epoch_reliable;
    const rmseOk   = s.rmse < meta.rmse_max;
    const noJumps  = s.jumps === 0;
    const overall  = epochOk && rmseOk && !s.is_precursor;

    const items = [
        {
            label: 'ĞĞ±Ñ‰Ğ¸Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ',
            value: overall ? 'âœ… ĞĞ°Ğ´Ñ‘Ğ¶Ğ½Ğ°' : 'âš ï¸ Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸',
            unit: '',
            cls: overall ? 'good' : 'warn'
        },
        {
            label: 'Ğ­Ğ¿Ğ¾Ñ…Ğ° Ğ½Ğ°Ğ´Ñ‘Ğ¶Ğ½Ğ°',
            value: epochOk ? 'Ğ”Ğ°' : 'ĞĞµÑ‚',
            unit: epochOk ? 'Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñƒ ÑĞ¿Ğ¾Ñ…Ğ¸ ĞµÑÑ‚ÑŒ' : `ÑĞºÑÑ‚Ñ€Ğ°Ğ¿Ğ¾Ğ»ÑÑ†Ğ¸Ñ ${s.dt_extrap.toFixed(2)} Ğ³.`,
            cls: epochOk ? 'good' : 'warn'
        },
        {
            label: 'RMSE Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°',
            value: s.rmse.toFixed(2),
            unit: 'Ğ¼Ğ¼',
            cls: rmseOk ? 'good' : 'warn'
        },
        {
            label: 'Ğ¡ĞºĞ°Ñ‡ĞºĞ¾Ğ²',
            value: s.jumps,
            unit: noJumps ? 'Ğ½Ğµ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¾' : 'ĞºĞ¾ÑĞµĞ¹ÑĞ¼. ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹',
            cls: noJumps ? 'good' : 'warn'
        },
 
    ];

    document.getElementById('status-metrics').innerHTML =
        items.map(it => `
            <div class="metric ${it.cls}">
                <div class="metric-label">${it.label}</div>
                <div class="metric-value">${it.value}</div>
                <div class="metric-unit">${it.unit}</div>
            </div>
        `).join('');
}

// â”€â”€ ĞšĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ‚Ñ‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderCoordsTable(s, meta) {
    const rows = [
        ['Ğ¨Ğ¸Ñ€Ğ¾Ñ‚Ğ° (Ğ³ĞµĞ¾Ğ´ĞµĞ·.)',   s.lat.toFixed(6),               'Â°',       'â€”',             ''],
        ['Ğ”Ğ¾Ğ»Ğ³Ğ¾Ñ‚Ğ° (Ğ³ĞµĞ¾Ğ´ĞµĞ·.)',  s.lon.toFixed(6),               'Â°',       'â€”',             ''],
        ['X (ECEF)',           s.x.toFixed(4),                 'Ğ¼',       `Â±${s.sigma_x.toFixed(2)}`, 'Ğ¼Ğ¼'],
        ['Y (ECEF)',           s.y.toFixed(4),                 'Ğ¼',       `Â±${s.sigma_y.toFixed(2)}`, 'Ğ¼Ğ¼'],
        ['Z (ECEF)',           s.z.toFixed(4),                 'Ğ¼',       `Â±${s.sigma_z.toFixed(2)}`, 'Ğ¼Ğ¼'],
    ];

    document.getElementById('coords-table').innerHTML = `
        <thead>
            <tr>
                <th>ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€</th>
                <th>Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ</th>
                <th>Ğ•Ğ´.</th>
                <th>Ğ¡ĞšĞ</th>
                <th>Ğ•Ğ´.</th>
            </tr>
        </thead>
        <tbody>
            ${rows.map(r => `
                <tr>
                    <td class="td-label">${r[0]}</td>
                    <td>${r[1]}</td>
                    <td>${r[2]}</td>
                    <td class="td-sigma">${r[3]}</td>
                    <td class="td-sigma">${r[4]}</td>
                </tr>
            `).join('')}
        </tbody>
    `;
}

// â”€â”€ Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚Ğ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderVelTable(s, meta) {
    const hasPlate = s.ve_plate !== undefined;
    const rows = [
        ['Ve (Ğ’Ğ¾ÑÑ‚Ğ¾Ğº, IGS20)',   s.ve.toFixed(2),    'Ğ¼Ğ¼/Ğ³Ğ¾Ğ´', `Â±${s.sigma_ve.toFixed(2)}`, 'Ğ¼Ğ¼/Ğ³Ğ¾Ğ´'],
        ['Vn (Ğ¡ĞµĞ²ĞµÑ€, IGS20)',    s.vn.toFixed(2),    'Ğ¼Ğ¼/Ğ³Ğ¾Ğ´', `Â±${s.sigma_vn.toFixed(2)}`, 'Ğ¼Ğ¼/Ğ³Ğ¾Ğ´'],
        ['Vu (Ğ’ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒ)',       s.vu.toFixed(2),    'Ğ¼Ğ¼/Ğ³Ğ¾Ğ´', `Â±${s.sigma_vu.toFixed(2)}`, 'Ğ¼Ğ¼/Ğ³Ğ¾Ğ´'],
    ];
    if (hasPlate) {
        rows.push(
            ['Ve plate-fixed',  s.ve_plate.toFixed(2), 'Ğ¼Ğ¼/Ğ³Ğ¾Ğ´', 'â€”', ''],
            ['Vn plate-fixed',  s.vn_plate.toFixed(2), 'Ğ¼Ğ¼/Ğ³Ğ¾Ğ´', 'â€”', ''],
        );
    }

    // Ğ“Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ
    const vh       = Math.sqrt(s.ve**2 + s.vn**2);
    const vh_sigma = Math.sqrt(s.sigma_ve**2 + s.sigma_vn**2);
    const azimuth  = (Math.atan2(s.ve, s.vn) * 180 / Math.PI + 360) % 360;
    rows.push(
        ['|Vh| Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚. ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ', vh.toFixed(2), 'Ğ¼Ğ¼/Ğ³Ğ¾Ğ´', `Â±${vh_sigma.toFixed(2)}`, 'Ğ¼Ğ¼/Ğ³Ğ¾Ğ´'],
        ['ĞĞ·Ğ¸Ğ¼ÑƒÑ‚ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚Ğ¸',          azimuth.toFixed(1), 'Â° (Ğ¾Ñ‚ Ğ¡, Ğ¿Ğ¾ Ñ‡Ğ°ÑĞ¾Ğ²Ğ¾Ğ¹)', 'â€”', ''],
    );

    document.getElementById('vel-table').innerHTML = `
        <thead>
            <tr>
                <th>ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€</th>
                <th>Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ</th>
                <th>Ğ•Ğ´.</th>
                <th>Ğ¡ĞšĞ</th>
                <th>Ğ•Ğ´.</th>
            </tr>
        </thead>
        <tbody>
            ${rows.map(r => `
                <tr>
                    <td class="td-label">${r[0]}</td>
                    <td>${r[1]}</td>
                    <td>${r[2]}</td>
                    <td class="td-sigma">${r[3]}</td>
                    <td class="td-sigma">${r[4]}</td>
                </tr>
            `).join('')}
        </tbody>
    `;
}

// â”€â”€ ĞšĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderQualityMetrics(s) {
    const spanYears = (s.t_span_end - s.t_span_start).toFixed(1);
    const items = [
        { label: 'ĞĞ°Ñ‡Ğ°Ğ»Ğ¾ Ñ€ÑĞ´Ğ°',    value: s.t_span_start.toFixed(2),   unit: 'Ğ³Ğ¾Ğ´' },
        { label: 'ĞšĞ¾Ğ½ĞµÑ† Ñ€ÑĞ´Ğ°',     value: s.t_span_end.toFixed(2),     unit: 'Ğ³Ğ¾Ğ´' },
        { label: 'Ğ”Ğ»Ğ¸Ğ½Ğ° Ñ€ÑĞ´Ğ°',     value: spanYears,                    unit: 'Ğ»ĞµÑ‚' },
        { label: 'ĞĞ°Ğ±Ğ»ÑĞ´ĞµĞ½Ğ¸Ğ¹',     value: s.n_obs,                      unit: 'ÑĞ¿Ğ¾Ñ…' },
        { label: 'ĞœĞ°ĞºÑ. Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»',   value: s.dt_gap.toFixed(3),          unit: 'Ğ»ĞµÑ‚' },
        { label: 'Ğ­ĞºÑÑ‚Ñ€Ğ°Ğ¿Ğ¾Ğ»ÑÑ†Ğ¸Ñ',  value: Math.abs(s.dt_extrap).toFixed(3), unit: 'Ğ»ĞµÑ‚' },
        { label: 'Ğ“Ğ¾Ğ´Ğ¾Ğ²Ğ°Ñ Ğ°Ğ¼Ğ¿Ğ». X', value: s.amp_annual_x.toFixed(1),  unit: 'Ğ¼Ğ¼' },
        { label: 'Ğ‘Ğ°Ğ»Ğ» ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ°',  value: Math.max(0, 100 - s.rmse*2 - s.jumps*2).toFixed(0), unit: '/ 100' },
    ];

    document.getElementById('quality-metrics').innerHTML =
        items.map(it => `
            <div class="metric">
                <div class="metric-label">${it.label}</div>
                <div class="metric-value">${it.value}</div>
                <div class="metric-unit">${it.unit}</div>
            </div>
        `).join('');
}

// â”€â”€ Plotly Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderPlot(divId, t, raw, filt, trend, yTitle, color) {
    const trace_raw = {
        x: t, y: raw, mode: 'markers', name: 'Ğ¡Ñ‹Ñ€Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ',
        marker: { size: 2.5, color: '#cbd5e1' }
    };
    const trace_filt = {
        x: t, y: filt, mode: 'lines', name: 'EKF Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ (Ğ¡ĞµĞ·Ğ¾Ğ½Ğ½Ğ¾ÑÑ‚ÑŒ)',
        line: { color: color, width: 2 }
    };

    const trace_trend = {
        x: t, y: trend, mode: 'lines', name: 'Ğ¢ĞµĞºÑ‚Ğ¾Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ñ‚Ñ€ĞµĞ½Ğ´',
        line: { color: '#333333', width: 2, dash: 'dot' }
    };

    const layout = {
        margin: { l: 55, r: 15, t: 10, b: 35 },
        showlegend: true,
        legend: { x: 0.01, y: 0.99, bgcolor: 'rgba(255,255,255,0.8)',
                  bordercolor: '#e2e8f0', borderwidth: 1, font: { size: 11 } },
        yaxis: { title: yTitle, titlefont: { size: 12 }, tickfont: { size: 11 } },
        xaxis: { tickfont: { size: 11 } },
        paper_bgcolor: 'white', plot_bgcolor: '#fafafa',
    };

    Plotly.newPlot(divId, [trace_raw, trace_filt, trace_trend], layout, {
        displayModeBar: true,
        modeBarButtonsToRemove: ['select2d','lasso2d','autoScale2d'],
        displaylogo: false,
        responsive: true
    });
}
</script>
</body>
</html>
